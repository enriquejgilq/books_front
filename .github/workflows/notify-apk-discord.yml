name: EAS Login Test

on:
  push:
    branches:
      - test-2
  pull_request:
    branches:
      - test-2

jobs:
  eas-login:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install eas-cli
        run: npm install -g eas-cli

      - name: Install expect
        run: sudo apt-get update && sudo apt-get install -y expect

      - name: EAS login using expect
        env:
          EAS_EMAIL: ${{ vars.EAS_EMAIL }}
          EAS_PASSWORD: ${{ vars.EAS_PASSWORD }}
        run: |
          expect <<EOF
          spawn eas login
          expect "Email address:"
          send "$EAS_EMAIL\r"
          expect "Password:"
          send "$EAS_PASSWORD\r"
          expect eof
          EOF

      - name: Check logged user
        run: eas whoami

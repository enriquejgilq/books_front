name: Comprobar Rama del Tag

on:
  push:
    tags:
      - 'preview-*'  # Este workflow se ejecutará cuando se empuje un tag que empiece con 'preview-'

jobs:
  check-tag-branch:
    name: Comprobar de qué rama proviene el tag
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Obtener el nombre del tag
        run: |
          TAG_NAME=${GITHUB_REF#refs/tags/}
          echo "Tag recibido: $TAG_NAME"
        
      - name: Obtener el commit al que apunta el tag
        run: |
          COMMIT_HASH=$(git rev-list -n 1 $TAG_NAME)
          echo "El tag $TAG_NAME está apuntando al commit: $COMMIT_HASH"
        
      - name: Buscar la rama asociada al commit
        run: |
          BRANCH_NAME=$(git branch -r --contains $COMMIT_HASH | sed 's/origin\///' | head -n 1)
          
          if [ -z "$BRANCH_NAME" ]; then
            echo "No se encontró la rama asociada al tag. Posiblemente el tag no tenga una rama de referencia directa."
          else
            echo "El tag $TAG_NAME proviene de la rama $BRANCH_NAME"
          fi

name: Verificar rama de origen del Tag

on:
  push:
    tags:
      - 'preview*'  # Este patrón es para cualquier tag que comience con 'preview'

jobs:
  check-branch:
    name: Verificar Rama de Origen del Tag
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Obtener el tag y la rama de origen
        run: |
          TAG_NAME=${GITHUB_REF#refs/tags/}
          echo "Tag recibido: $TAG_NAME"

          # Obtener el commit al que apunta el tag y luego obtener la rama
          COMMIT_HASH=$(git rev-list -n 1 $TAG_NAME)
          echo "El tag $TAG_NAME está apuntando al commit: $COMMIT_HASH"

          # Buscar la rama asociada a ese commit
          BRANCH_NAME=$(git branch -r --contains $COMMIT_HASH | sed 's/origin\///' | head -n 1)

          if [ -z "$BRANCH_NAME" ]; then
            echo "No se encontró la rama asociada al tag. Posiblemente el tag no tenga una rama de referencia directa."
          else
            echo "El tag $TAG_NAME proviene de la rama $BRANCH_NAME"
          fi
